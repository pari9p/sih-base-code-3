<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - PM Internship Scheme</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/beautiful.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <div class="logo">
                <a href="/dashboard">
                    <i class="fas fa-graduation-cap"></i>
                    PM Internship
                </a>
            </div>
            <div class="nav-menu" id="navMenu">
                <a href="/dashboard" class="active"><i class="fas fa-home"></i> Dashboard</a>
                <a href="/explore"><i class="fas fa-search"></i> Explore</a>
                <a href="/applications"><i class="fas fa-file-alt"></i> Applications</a>
                <a href="/profile"><i class="fas fa-user"></i> Profile</a>
                <a href="/read-aloud"><i class="fas fa-volume-up"></i> Read Aloud</a>
                <button onclick="logout()" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
            <div class="mobile-nav">
                <div class="hamburger-menu" onclick="toggleMobileMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="dashboard-header">
            <div class="welcome-section">
                <h1>Welcome back, {{ user.name if user else 'User' }}!</h1>
                <p>Here's your personalized internship dashboard</p>
            </div>
            
            {% if not user.profile_complete %}
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <strong>Complete your profile</strong>
                        <p>Complete your profile to get personalized internship recommendations</p>
                    </div>
                    <a href="/profile" class="btn btn-sm">Complete Now</a>
                </div>
            {% endif %}
        </div>

        <div class="dashboard-grid">
            <!-- Quick Stats -->
            <div class="stats-section">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-paper-plane"></i>
                    </div>
                    <div class="stat-content">
                        <h3>{{ applications|selectattr("status", "equalto", "applied")|list|length }}</h3>
                        <p>Applications Sent</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="stat-content">
                        <h3>{{ applications|selectattr("status", "equalto", "saved")|list|length }}</h3>
                        <p>Saved Internships</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-content">
                        <h3>{{ applications|selectattr("status", "equalto", "pending")|list|length }}</h3>
                        <p>Pending Reviews</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <h3>{{ applications|selectattr("status", "equalto", "completed")|list|length }}</h3>
                        <p>Completed</p>
                    </div>
                </div>
            </div>

            <!-- Personalized Recommendations -->
            <div class="recommendations-section">
                <div class="section-header">
                    <h2><i class="fas fa-star"></i> Recommended for You</h2>
                    <a href="/explore" class="view-all">View All</a>
                </div>
                
                {% if user.profile_complete %}
                    {% if recommendations %}
                        <div class="internship-cards">
                            {% for internship in recommendations[:3] %}
                                <div class="internship-card">
                                    <div class="card-header">
                                        <div class="company-logo">
                                            <i class="fas fa-building"></i>
                                        </div>
                                        <div class="match-score">
                                            <span class="score">{{ internship.match_score }}</span>
                                            <span class="label">Match</span>
                                        </div>
                                    </div>
                                    <div class="card-content">
                                        <h3>{{ internship.title }}</h3>
                                        <p class="company">{{ internship.company }}</p>
                                        <p class="location">
                                            <i class="fas fa-map-marker-alt"></i>
                                            {{ internship.location }}
                                        </p>
                                        <div class="skills">
                                            {% for skill in internship.skills_required[:3] %}
                                                <span class="skill-tag">{{ skill }}</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="card-actions">
                                        <button class="btn btn-primary btn-sm" data-id="{{ internship.id }}" data-title="{{ internship.title | e }}" onclick="applyToInternship(this.dataset.id, this.dataset.title)">
                                            <i class="fas fa-paper-plane"></i>
                                            Apply Now
                                        </button>
                                        <button class="btn btn-secondary btn-sm" data-id="{{ internship.id }}" data-title="{{ internship.title | e }}" onclick="saveInternship(this.dataset.id, this.dataset.title)">
                                            <i class="fas fa-heart"></i>
                                            Save
                                        </button>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="empty-state">
                            <i class="fas fa-search"></i>
                            <p>No recommendations found. Try updating your profile or exploring all internships.</p>
                            <a href="/explore" class="btn btn-primary">Explore Internships</a>
                        </div>
                    {% endif %}
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-user-edit"></i>
                        <p>Complete your profile to see personalized recommendations</p>
                        <a href="/profile" class="btn btn-primary">Complete Profile</a>
                    </div>
                {% endif %}
            </div>

            <!-- Recent Activity -->
            <div class="activity-section">
                <div class="section-header">
                    <h2><i class="fas fa-history"></i> Recent Activity</h2>
                    <a href="/applications" class="view-all">View All</a>
                </div>
                
                {% if applications %}
                    <div class="activity-list">
                        {% for app in applications[:5] %}
                            <div class="activity-item">
                                <div class="activity-icon status-{{ app.status }}">
                                    {% if app.status == 'applied' %}
                                        <i class="fas fa-paper-plane"></i>
                                    {% elif app.status == 'saved' %}
                                        <i class="fas fa-heart"></i>
                                    {% elif app.status == 'pending' %}
                                        <i class="fas fa-clock"></i>
                                    {% elif app.status == 'rejected' %}
                                        <i class="fas fa-times"></i>
                                    {% elif app.status == 'completed' %}
                                        <i class="fas fa-check"></i>
                                    {% endif %}
                                </div>
                                <div class="activity-content">
                                    <p class="activity-title">{{ app.internship_title }}</p>
                                    <p class="activity-status">Status: {{ app.status|title }}</p>
                                    <p class="activity-time">
                                        {% if app.status == 'applied' %}
                                            Applied {{ app.applied_at[:10] if app.applied_at else 'Recently' }}
                                        {% elif app.status == 'saved' %}
                                            Saved {{ app.saved_at[:10] if app.saved_at else 'Recently' }}
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-file-alt"></i>
                        <p>No activity yet. Start applying to internships!</p>
                        <a href="/explore" class="btn btn-primary">Explore Internships</a>
                    </div>
                {% endif %}
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <h2><i class="fas fa-bolt"></i> Quick Actions</h2>
                <div class="action-buttons">
                    <a href="/explore" class="action-btn">
                        <i class="fas fa-search"></i>
                        <span>Explore Internships</span>
                    </a>
                    <a href="/profile" class="action-btn">
                        <i class="fas fa-user-edit"></i>
                        <span>Update Profile</span>
                    </a>
                    <a href="/applications" class="action-btn">
                        <i class="fas fa-file-alt"></i>
                        <span>Track Applications</span>
                    </a>
                    <a href="/feedback" class="action-btn">
                        <i class="fas fa-comment"></i>
                        <span>Give Feedback</span>
                    </a>
                    <a href="/review" class="action-btn">
                        <i class="fas fa-star"></i>
                        <span>Review Internship</span>
                    </a>
                    <a href="/easy-apply" class="action-btn">
                        <i class="fas fa-magic"></i>
                        <span>Easy Apply</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function applyToInternship(internshipId, internshipTitle) {
            try {
                const response = await fetch('/api/apply', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        internship_id: internshipId,
                        internship_title: internshipTitle
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showSuccess('Application submitted successfully!');
                    setTimeout(() => location.reload(), 1000);
                } else {
                    showError(result.error);
                }
            } catch (error) {
                showError('Network error. Please try again.');
            }
        }

        async function saveInternship(internshipId, internshipTitle) {
            try {
                const response = await fetch('/api/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        internship_id: internshipId,
                        internship_title: internshipTitle
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showSuccess('Internship saved successfully!');
                    setTimeout(() => location.reload(), 1000);
                } else {
                    showError(result.error);
                }
            } catch (error) {
                showError('Network error. Please try again.');
            }
        }

        async function logout() {
            try {
                const response = await fetch('/api/logout', { method: 'POST' });
                const result = await response.json();
                if (result.success) {
                    window.location.href = result.redirect;
                }
            } catch (error) {
                window.location.href = '/';
            }
        }

        function provideFeedback() {
            alert('Feedback system will be implemented in the next version!');
        }

        function showSuccess(message) {
            showToast(message, 'success');
        }

        function showError(message) {
            showToast(message, 'error');
        }
        
        function showToast(message, type = 'error') {
            // Remove existing toasts
            const existingToasts = document.querySelectorAll('.toast');
            existingToasts.forEach(toast => toast.remove());
            
            // Create new toast
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icon = type === 'success' ? 'fas fa-check-circle' : 
                        type === 'warning' ? 'fas fa-exclamation-triangle' : 
                        'fas fa-exclamation-circle';
            
            toast.innerHTML = `
                <div class="toast-content">
                    <i class="${icon}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            // Trigger animation
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Auto remove after 4 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // Mobile menu functionality
        function toggleMobileMenu() {
            const navMenu = document.getElementById('navMenu');
            const hamburger = document.querySelector('.hamburger-menu');
            
            navMenu.classList.toggle('active');
            hamburger.classList.toggle('active');
        }

        // Close mobile menu when clicking on a link
        document.querySelectorAll('.nav-menu a').forEach(link => {
            link.addEventListener('click', () => {
                const navMenu = document.getElementById('navMenu');
                const hamburger = document.querySelector('.hamburger-menu');
                
                navMenu.classList.remove('active');
                hamburger.classList.remove('active');
            });
        });
    </script>
</body>
</html>