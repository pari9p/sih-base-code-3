<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Applications - PM Internship Scheme</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/beautiful.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <div class="logo">
                <a href="/dashboard">PM Internship</a>
            </div>
            <div class="nav-menu">
                <a href="/dashboard"><i class="fas fa-home"></i> Dashboard</a>
                <a href="/explore"><i class="fas fa-search"></i> Explore</a>
                <a href="/applications" class="active"><i class="fas fa-file-alt"></i> Applications</a>
                <a href="/profile"><i class="fas fa-user"></i> Profile</a>
                <button onclick="logout()" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="applications-header">
            <h1><i class="fas fa-file-alt"></i> My Applications</h1>
            <p>Track all your internship applications in one place</p>
        </div>

        <div class="applications-stats">
            <div class="stat-card">
                <div class="stat-icon status-applied">
                    <i class="fas fa-paper-plane"></i>
                </div>
                <div class="stat-content">
                    <h3>{{ applications|selectattr("status", "equalto", "applied")|list|length }}</h3>
                    <p>Applied</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon status-saved">
                    <i class="fas fa-heart"></i>
                </div>
                <div class="stat-content">
                    <h3>{{ applications|selectattr("status", "equalto", "saved")|list|length }}</h3>
                    <p>Saved</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon status-pending">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-content">
                    <h3>{{ applications|selectattr("status", "equalto", "pending")|list|length }}</h3>
                    <p>Under Review</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon status-rejected">
                    <i class="fas fa-times"></i>
                </div>
                <div class="stat-content">
                    <h3>{{ applications|selectattr("status", "equalto", "rejected")|list|length }}</h3>
                    <p>Not Selected</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon status-completed">
                    <i class="fas fa-trophy"></i>
                </div>
                <div class="stat-content">
                    <h3>{{ applications|selectattr("status", "equalto", "completed")|list|length }}</h3>
                    <p>Completed</p>
                </div>
            </div>
        </div>

        <div class="applications-filters">
            <div class="filter-tabs">
                <button class="tab-btn active" onclick="filterByStatus('all')">All Applications</button>
                <button class="tab-btn" onclick="filterByStatus('applied')">Applied</button>
                <button class="tab-btn" onclick="filterByStatus('saved')">Saved</button>
                <button class="tab-btn" onclick="filterByStatus('pending')">Under Review</button>
                <button class="tab-btn" onclick="filterByStatus('rejected')">Not Selected</button>
                <button class="tab-btn" onclick="filterByStatus('completed')">Completed</button>
            </div>
            
            <div class="search-box">
                <input type="text" id="searchApplications" placeholder="Search by internship title or company..." onkeyup="searchApplications()">
                <i class="fas fa-search"></i>
            </div>
        </div>

        <div class="applications-list" id="applicationsList">
            {% if applications %}
                {% for app in applications %}
                    <div class="application-card" data-status="{{ app.status }}">
                        <div class="card-left">
                            <div class="application-icon status-{{ app.status }}">
                                {% if app.status == 'applied' %}
                                    <i class="fas fa-paper-plane"></i>
                                {% elif app.status == 'saved' %}
                                    <i class="fas fa-heart"></i>
                                {% elif app.status == 'pending' %}
                                    <i class="fas fa-clock"></i>
                                {% elif app.status == 'rejected' %}
                                    <i class="fas fa-times"></i>
                                {% elif app.status == 'completed' %}
                                    <i class="fas fa-trophy"></i>
                                {% endif %}
                            </div>
                            
                            <div class="application-info">
                                <h3>{{ app.internship_title }}</h3>
                                <p class="application-id">Application ID: {{ app.id[:8] }}</p>
                                <p class="application-date">
                                    {% if app.status == 'applied' %}
                                        Applied on: {{ app.applied_at[:10] if app.applied_at else 'N/A' }}
                                    {% elif app.status == 'saved' %}
                                        Saved on: {{ app.saved_at[:10] if app.saved_at else 'N/A' }}
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                        
                        <div class="card-right">
                            <div class="status-badge status-{{ app.status }}">
                                {{ app.status|title }}
                            </div>
                            
                            <div class="application-actions">
                                {% if app.status == 'saved' %}
                                    <button class="btn btn-sm btn-primary" onclick="applyFromSaved('{{ app.id }}', '{{ app.internship_title }}')">
                                        <i class="fas fa-paper-plane"></i>
                                        Apply Now
                                    </button>
                                {% elif app.status == 'applied' %}
                                    <button class="btn btn-sm btn-secondary" onclick="trackApplication('{{ app.id }}')">
                                        <i class="fas fa-eye"></i>
                                        Track Status
                                    </button>
                                {% elif app.status == 'completed' %}
                                    <button class="btn btn-sm btn-primary" onclick="writeReview('{{ app.internship_title }}')">
                                        <i class="fas fa-star"></i>
                                        Write Review
                                    </button>
                                {% endif %}
                                
                                <button class="btn btn-sm btn-outline" onclick="viewDetails('{{ app.internship_id }}')">
                                    <i class="fas fa-info-circle"></i>
                                    Details
                                </button>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <i class="fas fa-file-alt"></i>
                    <h3>No Applications Yet</h3>
                    <p>You haven't applied to any internships yet. Start exploring opportunities!</p>
                    <a href="/explore" class="btn btn-primary">
                        <i class="fas fa-search"></i>
                        Explore Internships
                    </a>
                </div>
            {% endif %}
        </div>

        <!-- Application Timeline Modal (for tracking) -->
        <div id="timelineModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-history"></i> Application Timeline</h2>
                    <button class="close-modal" onclick="closeModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="timeline">
                        <div class="timeline-item completed">
                            <div class="timeline-icon">
                                <i class="fas fa-paper-plane"></i>
                            </div>
                            <div class="timeline-content">
                                <h4>Application Submitted</h4>
                                <p>Your application has been successfully submitted.</p>
                                <span class="timeline-date">2 days ago</span>
                            </div>
                        </div>
                        
                        <div class="timeline-item completed">
                            <div class="timeline-icon">
                                <i class="fas fa-eye"></i>
                            </div>
                            <div class="timeline-content">
                                <h4>Application Reviewed</h4>
                                <p>Your application is being reviewed by the hiring team.</p>
                                <span class="timeline-date">1 day ago</span>
                            </div>
                        </div>
                        
                        <div class="timeline-item current">
                            <div class="timeline-icon">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div class="timeline-content">
                                <h4>Interview Scheduled</h4>
                                <p>You will be contacted for the next round shortly.</p>
                                <span class="timeline-date">Pending</span>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-icon">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="timeline-content">
                                <h4>Final Decision</h4>
                                <p>Final decision on your application.</p>
                                <span class="timeline-date">Pending</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function filterByStatus(status) {
            // Update active tab
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Filter applications
            const applications = document.querySelectorAll('.application-card');
            applications.forEach(app => {
                if (status === 'all' || app.dataset.status === status) {
                    app.style.display = 'flex';
                } else {
                    app.style.display = 'none';
                }
            });
        }

        function searchApplications() {
            const searchTerm = document.getElementById('searchApplications').value.toLowerCase();
            const applications = document.querySelectorAll('.application-card');
            
            applications.forEach(app => {
                const title = app.querySelector('h3').textContent.toLowerCase();
                if (title.includes(searchTerm)) {
                    app.style.display = 'flex';
                } else {
                    app.style.display = 'none';
                }
            });
        }

        async function applyFromSaved(applicationId, internshipTitle) {
            try {
                // This would update the application status from 'saved' to 'applied'
                showSuccess(`Applied to ${internshipTitle} successfully!`);
                setTimeout(() => location.reload(), 1000);
            } catch (error) {
                showError('Failed to apply. Please try again.');
            }
        }

        function trackApplication(applicationId) {
            // Show timeline modal
            document.getElementById('timelineModal').classList.remove('hidden');
        }

        function writeReview(internshipTitle) {
            alert(`Review system for ${internshipTitle} will be implemented in the next version!`);
        }

        function viewDetails(internshipId) {
            alert('Detailed view will be implemented in the next version!');
        }

        function closeModal() {
            document.getElementById('timelineModal').classList.add('hidden');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('timelineModal');
            if (event.target === modal) {
                modal.classList.add('hidden');
            }
        }

        async function logout() {
            try {
                const response = await fetch('/api/logout', { method: 'POST' });
                const result = await response.json();
                if (result.success) {
                    window.location.href = result.redirect;
                }
            } catch (error) {
                window.location.href = '/';
            }
        }

        function showSuccess(message) {
            showToast(message, 'success');
        }

        function showError(message) {
            showToast(message, 'error');
        }
        
        function showToast(message, type = 'error') {
            // Remove existing toasts
            const existingToasts = document.querySelectorAll('.toast');
            existingToasts.forEach(toast => toast.remove());
            
            // Create new toast
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icon = type === 'success' ? 'fas fa-check-circle' : 
                        type === 'warning' ? 'fas fa-exclamation-triangle' : 
                        'fas fa-exclamation-circle';
            
            toast.innerHTML = `
                <div class="toast-content">
                    <i class="${icon}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            // Trigger animation
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Auto remove after 4 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }
    </script>
</body>
</html>